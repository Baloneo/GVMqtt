(function(e){function t(t){for(var n,i,r=t[0],a=t[1],l=t[2],p=0,d=[];p<r.length;p++)i=r[p],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&d.push(s[i][0]),s[i]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);u&&u(t);while(d.length)d.shift()();return c.push.apply(c,l||[]),o()}function o(){for(var e,t=0;t<c.length;t++){for(var o=c[t],n=!0,r=1;r<o.length;r++){var a=o[r];0!==s[a]&&(n=!1)}n&&(c.splice(t--,1),e=i(i.s=o[0]))}return e}var n={},s={app:0},c=[];function i(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=n,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/static/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],a=r.push.bind(r);r.push=t,r=r.slice();for(var l=0;l<r.length;l++)t(r[l]);var u=a;c.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},2803:function(e,t,o){},"56d7":function(e,t,o){"use strict";o.r(t);o("e260"),o("e6cf"),o("cca6"),o("a79d");var n=o("2b0e"),s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[o("HelloWorld")],1)},c=[],i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-container",[o("el-main",[o("p",{on:{click:function(t){return e.initData()}}},[e._v("是否连接了: "+e._s(e.isConnected))]),o("div",{staticClass:"demo-input-suffix"},[o("el-input",{attrs:{size:"large",placeholder:"mqtt.com:1883","prefix-icon":"el-icon-s-platform"},model:{value:e.mqttBrokerURL,callback:function(t){e.mqttBrokerURL=t},expression:"mqttBrokerURL"}})],1),o("div",{staticClass:"demo-input-suffix"},[o("el-input",{attrs:{size:"large",placeholder:"用户名","prefix-icon":"el-icon-user"},model:{value:e.mqttUserName,callback:function(t){e.mqttUserName=t},expression:"mqttUserName"}})],1),o("div",{staticClass:"demo-input-suffix"},[o("el-input",{attrs:{size:"large",placeholder:"密码","prefix-icon":"el-icon-lock"},model:{value:e.mqttPassword,callback:function(t){e.mqttPassword=t},expression:"mqttPassword"}})],1),o("el-button",{staticStyle:{"margin-bottom":"50px"},attrs:{type:"primary",loading:e.connecting},on:{click:function(t){return e.connectMqtt()}}},[e._v("连接")]),o("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isConnected,expression:"isConnected"}],staticStyle:{"margin-bottom":"50px"},attrs:{type:"danger",autosize:!0},on:{click:function(t){return e.disconnect()}}},[e._v("断开")]),o("div",{staticClass:"demo-input-suffix"},[o("el-input",{attrs:{size:"large",placeholder:"Topic"},model:{value:e.topic,callback:function(t){e.topic=t},expression:"topic"}})],1),o("div",{staticClass:"demo-input-suffix"},[o("el-input",{attrs:{type:"textarea",rows:2,placeholder:"要发送的消息"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1),o("el-button",{staticStyle:{"margin-bottom":"50px"},attrs:{type:"primary"},on:{click:function(t){return e.sendMessage()}}},[e._v("发送")]),o("div",{staticClass:"demo-input-suffix"},[o("el-input",{attrs:{size:"large",placeholder:"Topic"},model:{value:e.subTopic,callback:function(t){e.subTopic=t},expression:"subTopic"}})],1),o("el-button",{staticStyle:{"margin-bottom":"50px"},attrs:{type:"primary"},on:{click:function(t){return e.subscribe()}}},[e._v("订阅")]),o("div",{staticClass:"demo-input-suffix"},[o("el-input",{attrs:{type:"textarea",rows:2,placeholder:"收到的消息",autosize:!0},model:{value:e.recvMessage,callback:function(t){e.recvMessage=t},expression:"recvMessage"}})],1),o("el-button",{staticStyle:{"margin-bottom":"50px"},attrs:{type:"primary"},on:{click:function(t){return e.getRecvMessage()}}},[e._v("刷新")]),o("el-button",{staticStyle:{"margin-bottom":"50px"},attrs:{type:"danger"},on:{click:function(t){return e.deleteMessage()}}},[e._v(e._s(e.stopRecv?"继续":"暂停"))])],1)],1)},r=[],a=(o("d3b7"),o("bc3a")),l=o.n(a),u=o("5c96"),p=o.n(u);function d(){var e=l.a.create({baseURL:window.location.origin,timeout:5e3});return e.interceptors.response.use((function(e){return 2e3!=e.data.errcode&&u["Notification"].error({title:"操作失败",message:e.data.errmsg}),e}),(function(e){console.log("调用了响应 失败拦截器",e),u["Notification"].error({title:"请求错误",message:e})})),e.interceptors.request.use((function(e){return console.log("config",e),e}),(function(e){return console.log("error",e),Promise.reject(e)})),e}function f(e,t,o){return d().post("/mqtt",{username:t,password:o,broker:e})}var m="ws://"+window.location.host+"/data",g={name:"HelloWorld",created:function(){this.initData(),this.initWebSocket()},data:function(){return{mqttBrokerURL:"mqtt.com:1883",mqttUserName:"admin",mqttPassword:"admin",topic:"/testtopic",message:'{"msg": "hello world!"}',isConnected:!1,connecting:!1,subTopic:"/testtopic",recvMessage:"",stopRecv:!1,wsuri:m,socket:null}},destroyed:function(){this.socket.close()},methods:{deleteMessage:function(){this.stopRecv=!this.stopRecv},getRecvMessage:function(){var e=this;d().get("/mqtt/message").then((function(t){console.log(t),e.recvMessage=t.data.data}))},subscribe:function(){d().post("/mqtt/subscription",{topic:this.subTopic}).then((function(e){2e3==e.data.errcode&&u["Notification"].success("订阅成功")}))},connectMqtt:function(){var e=this;this.connecting=!0,f(this.mqttBrokerURL,this.mqttUserName,this.mqttPassword).then((function(t){console.log("connectMqtt",t),2e3==t.data.errcode&&(e.isConnected=!0)})).finally((function(){e.connecting=!1}))},disconnect:function(){var e=this;d().delete("/mqtt").then((function(t){console.log(t),e.isConnected=!1}))},sendMessage:function(){d().post("/mqtt/message",{topic:this.topic,message:this.message})},initData:function(){var e=this;d().get("/mqtt/status").then((function(t){console.log(t),e.isConnected=t.data.data["is_connected"]})).catch((function(e){console.log("/status error",e)}))},reconnect:function(){var e=this;console.log("尝试重连"),this.lockReconnect||this.maxReconnect<=0||setTimeout((function(){e.initWebSocket()}),6e4)},initWebSocket:function(){try{"WebSocket"in window?this.socket=new WebSocket(this.wsuri):console.log("您的浏览器不支持websocket"),this.socket.onopen=this.websocketonopen,this.socket.onerror=this.websocketonerror,this.socket.onmessage=this.websocketonmessage,this.socket.onclose=this.websocketclose}catch(e){this.reconnect()}},websocketonopen:function(){console.log("WebSocket连接成功",this.socket.readyState)},websocketonerror:function(e){console.log("WebSocket连接发生错误",e),this.reconnect()},websocketonmessage:function(e){console.log("websocket数据",e.data),this.stopRecv||(this.recvMessage.length>=1e3&&(this.recvMessage=""),this.recvMessage+=e.data,this.recvMessage+="\n\n")},websocketclose:function(e){console.log("connection closed ("+e.code+")"),this.reconnect()},websocketsend:function(e){console.log(e),this.socket.send(e)}},computed:{}},h=g,b=(o("c733"),o("2877")),v=Object(b["a"])(h,i,r,!1,null,"1adac98f",null),k=v.exports,w={name:"App",components:{HelloWorld:k}},y=w,x=Object(b["a"])(y,s,c,!1,null,null,null),q=x.exports;o("0fae");n["default"].use(p.a,{size:"small",zIndex:3e3}),n["default"].config.productionTip=!1,new n["default"]({render:function(e){return e(q)}}).$mount("#app")},c733:function(e,t,o){"use strict";var n=o("2803"),s=o.n(n);s.a}});
//# sourceMappingURL=app.98f76dba.js.map